{"ast":null,"code":"import _Form from \"antd/lib/form\";\nimport _Input from \"antd/lib/input\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _JSXStyle from \"styled-jsx/style\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'React';\nimport { isEmpty } from 'zgl-utils-js';\nimport httpAgent from '../httpAgent';\nimport cn from 'classnames';\nimport styles from '../styles/comment.module.scss';\nconst {\n  TextArea\n} = _Input;\nimport LocalizedModal from '../components/others/LocalizedModal';\n\nclass Comment extends React.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"handleSubmit\", ({\n      parentCommentId,\n      parentCommentUserId,\n      replyCommentId,\n      replyCommentUserId,\n      commentLevel,\n      content\n    }) => {\n      if (!this.state.isUser) {\n        this.setState({\n          visible: true\n        });\n        return;\n      }\n\n      if (!content) {\n        return;\n      }\n\n      const params = {\n        articleId: this.articleId,\n        // 文章id\n        userid: this.state.com_user_info.id,\n        // 评论人id\n        parentCommentId,\n        // 父评论id\n        parentCommentUserId,\n        // 父级评论的userid\n        replyCommentId,\n        // 被回复的userid\n        replyCommentUserId,\n        // 被回复的用户id\n        commentLevel,\n        // 评论级别\n        content // 内容\n\n      };\n      httpAgent({\n        url: '/message/addCommentList',\n        method: 'post',\n        params\n      }).then(res => {\n        if (res.code === 0) {\n          this.getCommentList();\n          this.setState({\n            commlist: [],\n            comChildList: []\n          });\n        }\n\n        this.setState({\n          visible: false\n        });\n      });\n    });\n\n    _defineProperty(this, \"onReviewBackMessage\", (one, cur, index) => {\n      if (one === 1) {\n        const commlist = this.state.commlist;\n        commlist.push(cur);\n        this.setState({\n          commlist\n        });\n      }\n\n      if (one === 2) {\n        const comChildList = this.state.comChildList;\n        comChildList.push(cur + '_' + index);\n        this.setState({\n          comChildList\n        });\n      }\n    });\n\n    this.state = {\n      isUser: false,\n      visible: false,\n      user_ip: this.props.user_ip,\n      content: '',\n      com_user_info: {},\n      commentList: [],\n      length: 0,\n      commlist: [],\n      comChildList: [],\n      oneIndex: null\n    };\n    this.articleId = this.props.slug;\n  }\n\n  getCommentList() {\n    httpAgent({\n      url: '/message/getCommentList',\n      method: 'post',\n      params: {\n        articleId: this.props.slug\n      }\n    }).then(res => {\n      let length = res.data.length;\n      res.data && res.data.forEach(element => {\n        length = length + element.child.length;\n      });\n      this.setState({\n        commentList: res.data,\n        length\n      });\n    });\n  }\n\n  componentDidMount() {\n    this.getCommentList();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const {\n      com_user_info\n    } = this.state;\n\n    if (JSON.stringify(nextProps.com_user_info) != JSON.stringify(com_user_info)) {\n      this.setState({\n        com_user_info: nextProps.com_user_info\n      });\n\n      if (!isEmpty(nextProps.com_user_info)) {\n        this.setState({\n          isUser: true\n        });\n      }\n    }\n  }\n\n  render() {\n    const {\n      com_user_info,\n      commentList,\n      length,\n      commlist,\n      comChildList\n    } = this.state;\n    return /*#__PURE__*/_jsxs(\"div\", {\n      id: \"note-page-comment\",\n      className: \"jsx-2354907394\",\n      children: [/*#__PURE__*/_jsx(LocalizedModal, {\n        visible: this.state.visible,\n        user_ip: this.state.user_ip\n      }), /*#__PURE__*/_jsxs(\"section\", {\n        className: \"jsx-2354907394\" + \" \" + (styles.ouvJEz || \"\"),\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"jsx-2354907394\" + \" \" + (styles._26JdYM || \"\"),\n          children: [/*#__PURE__*/_jsx(\"img\", {\n            src: \"https://upload.jianshu.io/users/upload_avatars/25124160/9f030a41-c698-4d43-a999-ff9a8cc3c6e6?imageMogr2/auto-orient/strip|imageView2/1/w/80/h/80/format/webp\",\n            alt: \"\",\n            className: \"jsx-2354907394\" + \" \" + (styles._3LHFA || \"\")\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"jsx-2354907394\" + \" \" + (styles._3GKFE3 || \"\"),\n            children: /*#__PURE__*/_jsxs(_Form, {\n              onFinish: this.handleSubmit,\n              children: [/*#__PURE__*/_jsxs(\"div\", {\n                className: \"jsx-2354907394\" + \" \" + (styles.heightNone || \"\"),\n                children: [/*#__PURE__*/_jsx(_Form.Item, {\n                  name: \"parentCommentId\",\n                  initialValue: null,\n                  children: /*#__PURE__*/_jsx(_Input, {})\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  name: \"parentCommentUserId\",\n                  initialValue: null,\n                  children: /*#__PURE__*/_jsx(_Input, {})\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  name: \"replyCommentId\",\n                  initialValue: null,\n                  children: /*#__PURE__*/_jsx(_Input, {})\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  name: \"replyCommentUserId\",\n                  initialValue: null,\n                  children: /*#__PURE__*/_jsx(_Input, {})\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  name: \"commentLevel\",\n                  initialValue: 1,\n                  children: /*#__PURE__*/_jsx(_Input, {})\n                })]\n              }), /*#__PURE__*/_jsx(_Form.Item, {\n                name: \"content\",\n                children: /*#__PURE__*/_jsx(TextArea, {\n                  className: styles._1u_H4i,\n                  placeholder: \"\\u5199\\u4E0B\\u4F60\\u7684\\u8BC4\\u8BBA...\"\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"jsx-2354907394\",\n                children: /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"jsx-2354907394\" + \" \" + (styles._3IXP9Q || \"\"),\n                  children: [/*#__PURE__*/_jsx(\"div\", {\n                    className: \"jsx-2354907394\" + \" \" + (styles.SKZUyR || \"\"),\n                    children: (com_user_info === null || com_user_info === void 0 ? void 0 : com_user_info.nickname) ? com_user_info === null || com_user_info === void 0 ? void 0 : com_user_info.nickname : ''\n                  }), /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"jsx-2354907394\" + \" \" + (styles._3Tp4of || \"\"),\n                    children: [/*#__PURE__*/_jsx(\"button\", {\n                      type: \"submit\",\n                      disabled: \"\",\n                      className: \"jsx-2354907394\" + \" \" + (cn(styles._1OyPqC, styles.fabuss) || \"\"),\n                      children: /*#__PURE__*/_jsx(\"span\", {\n                        className: \"jsx-2354907394\",\n                        children: \"\\u53D1\\u5E03\"\n                      })\n                    }), /*#__PURE__*/_jsx(\"button\", {\n                      type: \"button\",\n                      className: \"jsx-2354907394\" + \" \" + (styles._1OyPqC || \"\"),\n                      children: /*#__PURE__*/_jsx(\"span\", {\n                        className: \"jsx-2354907394\",\n                        children: \"\\u53D6\\u6D88\"\n                      })\n                    })]\n                  })]\n                })\n              })]\n            })\n          })]\n        }), /*#__PURE__*/_jsx(\"h3\", {\n          className: \"jsx-2354907394\" + \" \" + (styles.QxT4hD || \"\"),\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"jsx-2354907394\" + \" \" + (styles._10KzV0 || \"\"),\n            children: [/*#__PURE__*/_jsx(\"span\", {\n              className: \"jsx-2354907394\",\n              children: \"\\u5168\\u90E8\\u8BC4\\u8BBA\"\n            }), /*#__PURE__*/_jsx(\"span\", {\n              className: \"jsx-2354907394\" + \" \" + (styles._2R7vBo || \"\"),\n              children: length\n            })]\n          })\n        }), commentList.map((comment, index) => {\n          return /*#__PURE__*/_jsxs(\"div\", {\n            id: \"comment-63103346\",\n            className: \"jsx-2354907394\" + \" \" + (cn(styles._2IUqvs, styles._3uuww8) || \"\"),\n            children: [/*#__PURE__*/_jsx(\"a\", {\n              href: \"#\",\n              target: \"_blank\",\n              rel: \"noopener noreferrer\",\n              className: \"jsx-2354907394\" + \" \" + (styles._1OhGeD || \"\"),\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: comment.userInfo.headPicture,\n                alt: \"\",\n                className: \"jsx-2354907394\" + \" \" + (styles._1_jhXc || \"\")\n              })\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"jsx-2354907394\" + \" \" + (styles._1K9gkf || \"\"),\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"jsx-2354907394\" + \" \" + (styles._23G05g || \"\"),\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  href: \"#\",\n                  target: \"_blank\",\n                  rel: \"noopener noreferrer\",\n                  className: \"jsx-2354907394\" + \" \" + (styles._1OhGeD || \"\"),\n                  children: comment.userInfo.nickname\n                })\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"jsx-2354907394\" + \" \" + (styles._1xqkrI || \"\"),\n                children: [/*#__PURE__*/_jsxs(\"span\", {\n                  className: \"jsx-2354907394\",\n                  children: [index + 1, \"\\u697C \"]\n                }), /*#__PURE__*/_jsx(\"time\", {\n                  className: \"jsx-2354907394\",\n                  children: comment.createDate\n                })]\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"jsx-2354907394\" + \" \" + (styles._2bDGm4 || \"\"),\n                children: comment.content\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"jsx-2354907394\" + \" \" + (styles._2ti5br || \"\"),\n                children: /*#__PURE__*/_jsx(\"div\", {\n                  className: \"jsx-2354907394\" + \" \" + (styles._3MyyYc || \"\"),\n                  children: /*#__PURE__*/_jsx(\"span\", {\n                    onClick: () => this.onReviewBackMessage(1, index),\n                    role: \"button\",\n                    \"aria-label\": \"\\u6DFB\\u52A0\\u8BC4\\u8BBA\",\n                    className: \"jsx-2354907394\" + \" \" + (styles._1Jvkh4 || \"\"),\n                    children: \"\\u56DE\\u590D\"\n                  })\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"jsx-2354907394\" + \" \" + (cn(styles.hideBlock, {\n                  [styles.showBlock]: commlist.some(so => so === index)\n                }) || \"\"),\n                children: /*#__PURE__*/_jsx(\"div\", {\n                  className: \"jsx-2354907394\" + \" \" + (styles._3GKFE3 || \"\"),\n                  children: /*#__PURE__*/_jsxs(_Form, {\n                    onFinish: this.handleSubmit,\n                    children: [/*#__PURE__*/_jsxs(\"div\", {\n                      className: \"jsx-2354907394\" + \" \" + (styles.heightNone || \"\"),\n                      children: [/*#__PURE__*/_jsx(_Form.Item, {\n                        name: \"parentCommentId\",\n                        initialValue: comment.id,\n                        children: /*#__PURE__*/_jsx(_Input, {})\n                      }), /*#__PURE__*/_jsx(_Form.Item, {\n                        name: \"parentCommentUserId\",\n                        initialValue: comment.userid,\n                        children: /*#__PURE__*/_jsx(_Input, {})\n                      }), /*#__PURE__*/_jsx(_Form.Item, {\n                        name: \"replyCommentId\",\n                        initialValue: null,\n                        children: /*#__PURE__*/_jsx(_Input, {})\n                      }), /*#__PURE__*/_jsx(_Form.Item, {\n                        name: \"replyCommentUserId\",\n                        initialValue: null,\n                        children: /*#__PURE__*/_jsx(_Input, {})\n                      }), /*#__PURE__*/_jsx(_Form.Item, {\n                        name: \"commentLevel\",\n                        initialValue: 2,\n                        children: /*#__PURE__*/_jsx(_Input, {})\n                      })]\n                    }), /*#__PURE__*/_jsx(_Form.Item, {\n                      name: \"content\",\n                      children: /*#__PURE__*/_jsx(TextArea, {\n                        className: styles._1u_H4i,\n                        placeholder: \"\\u5199\\u4E0B\\u4F60\\u7684\\u8BC4\\u8BBA...\"\n                      })\n                    }), /*#__PURE__*/_jsx(\"div\", {\n                      className: \"jsx-2354907394\",\n                      children: /*#__PURE__*/_jsxs(\"div\", {\n                        className: \"jsx-2354907394\" + \" \" + (styles._3IXP9Q || \"\"),\n                        children: [/*#__PURE__*/_jsx(\"div\", {\n                          className: \"jsx-2354907394\" + \" \" + (styles.SKZUyR || \"\")\n                        }), /*#__PURE__*/_jsxs(\"div\", {\n                          className: \"jsx-2354907394\" + \" \" + (styles._3Tp4of || \"\"),\n                          children: [/*#__PURE__*/_jsx(\"button\", {\n                            type: \"submit\",\n                            disabled: \"\",\n                            className: \"jsx-2354907394\" + \" \" + (cn(styles._1OyPqC, styles.fabuss) || \"\"),\n                            children: /*#__PURE__*/_jsx(\"span\", {\n                              className: \"jsx-2354907394\",\n                              children: \"\\u53D1\\u5E03\"\n                            })\n                          }), /*#__PURE__*/_jsx(\"button\", {\n                            type: \"button\",\n                            className: \"jsx-2354907394\" + \" \" + (styles._1OyPqC || \"\"),\n                            children: /*#__PURE__*/_jsx(\"span\", {\n                              className: \"jsx-2354907394\",\n                              children: \"\\u53D6\\u6D88\"\n                            })\n                          })]\n                        })]\n                      })\n                    })]\n                  })\n                })\n              }), comment.child.map((child, cur) => {\n                return /*#__PURE__*/_jsx(\"div\", {\n                  className: \"jsx-2354907394\" + \" \" + (styles._2kvBge || \"\"),\n                  children: /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"jsx-2354907394\" + \" \" + (styles._3g0yKR || \"\"),\n                    children: [/*#__PURE__*/_jsx(\"div\", {\n                      className: \"jsx-2354907394\" + \" \" + (styles._3d_vFY || \"\"),\n                      children: /*#__PURE__*/_jsxs(\"div\", {\n                        className: \"jsx-2354907394\",\n                        children: [/*#__PURE__*/_jsxs(\"div\", {\n                          className: \"jsx-2354907394\" + \" \" + (styles._23G05g || \"\"),\n                          children: [/*#__PURE__*/_jsx(\"a\", {\n                            href: \"#\",\n                            target: \"_blank\",\n                            rel: \"noopener noreferrer\",\n                            className: \"jsx-2354907394\" + \" \" + (styles._1OhGeD || \"\"),\n                            children: child.userInfo.nickname\n                          }), child.isAuthor === 1 ? /*#__PURE__*/_jsx(\"span\", {\n                            className: \"jsx-2354907394\" + \" \" + (styles._3pyYXB || \"\"),\n                            children: \"\\u4F5C\\u8005\"\n                          }) : /*#__PURE__*/_jsx(\"span\", {\n                            className: \"jsx-2354907394\"\n                          })]\n                        }), /*#__PURE__*/_jsx(\"div\", {\n                          className: \"jsx-2354907394\" + \" \" + (styles._1xqkrI || \"\"),\n                          children: /*#__PURE__*/_jsx(\"time\", {\n                            className: \"jsx-2354907394\" + \" \" + \"2020-12-18T06:45:56.000Z\",\n                            children: child.createDate\n                          })\n                        })]\n                      })\n                    }), /*#__PURE__*/_jsxs(\"div\", {\n                      className: \"jsx-2354907394\" + \" \" + (styles._2bDGm4 || \"\"),\n                      children: [child.replyCommentNickName ? /*#__PURE__*/_jsxs(\"a\", {\n                        href: \"#\",\n                        target: \"_blank\",\n                        \"data-user-slug\": \"a92d6c1e2f2f\",\n                        className: \"jsx-2354907394\" + \" \" + (styles.maleskineauthor || \"\"),\n                        children: [\"@\", child.replyCommentNickName]\n                      }) : /*#__PURE__*/_jsx(\"span\", {\n                        className: \"jsx-2354907394\"\n                      }), child.content]\n                    }), /*#__PURE__*/_jsx(\"div\", {\n                      className: \"jsx-2354907394\" + \" \" + (styles._2ti5br || \"\"),\n                      children: /*#__PURE__*/_jsx(\"div\", {\n                        className: \"jsx-2354907394\" + \" \" + (styles._3MyyYc || \"\"),\n                        children: /*#__PURE__*/_jsx(\"span\", {\n                          role: \"button\",\n                          \"aria-label\": \"\\u56DE\\u590D\\u8BC4\\u8BBA\",\n                          onClick: () => this.onReviewBackMessage(2, cur, index),\n                          className: \"jsx-2354907394\" + \" \" + (styles._1Jvkh4 || \"\"),\n                          children: \"\\u56DE\\u590D\"\n                        })\n                      })\n                    }), /*#__PURE__*/_jsx(\"div\", {\n                      className: \"jsx-2354907394\" + \" \" + (cn(styles.hideBlock, {\n                        [styles.showBlock]: comChildList.some(so => so === cur + '_' + index)\n                      }) || \"\"),\n                      children: /*#__PURE__*/_jsx(\"div\", {\n                        className: \"jsx-2354907394\" + \" \" + (styles._3GKFE3 || \"\"),\n                        children: /*#__PURE__*/_jsxs(_Form, {\n                          onFinish: this.handleSubmit,\n                          children: [/*#__PURE__*/_jsxs(\"div\", {\n                            className: \"jsx-2354907394\" + \" \" + (styles.heightNone || \"\"),\n                            children: [/*#__PURE__*/_jsx(_Form.Item, {\n                              name: \"parentCommentId\",\n                              initialValue: comment.id,\n                              children: /*#__PURE__*/_jsx(_Input, {})\n                            }), /*#__PURE__*/_jsx(_Form.Item, {\n                              name: \"parentCommentUserId\",\n                              initialValue: comment.userid,\n                              children: /*#__PURE__*/_jsx(_Input, {})\n                            }), /*#__PURE__*/_jsx(_Form.Item, {\n                              name: \"replyCommentId\",\n                              initialValue: child.id,\n                              children: /*#__PURE__*/_jsx(_Input, {})\n                            }), /*#__PURE__*/_jsx(_Form.Item, {\n                              name: \"replyCommentUserId\",\n                              initialValue: child.userid,\n                              children: /*#__PURE__*/_jsx(_Input, {})\n                            }), /*#__PURE__*/_jsx(_Form.Item, {\n                              name: \"commentLevel\",\n                              initialValue: 2,\n                              children: /*#__PURE__*/_jsx(_Input, {})\n                            })]\n                          }), /*#__PURE__*/_jsx(_Form.Item, {\n                            name: \"content\",\n                            children: /*#__PURE__*/_jsx(TextArea, {\n                              className: styles._1u_H4i,\n                              placeholder: \"\\u5199\\u4E0B\\u4F60\\u7684\\u8BC4\\u8BBA...\"\n                            })\n                          }), /*#__PURE__*/_jsx(\"div\", {\n                            className: \"jsx-2354907394\",\n                            children: /*#__PURE__*/_jsxs(\"div\", {\n                              className: \"jsx-2354907394\" + \" \" + (styles._3IXP9Q || \"\"),\n                              children: [/*#__PURE__*/_jsx(\"div\", {\n                                className: \"jsx-2354907394\" + \" \" + (styles.SKZUyR || \"\")\n                              }), /*#__PURE__*/_jsxs(\"div\", {\n                                className: \"jsx-2354907394\" + \" \" + (styles._3Tp4of || \"\"),\n                                children: [/*#__PURE__*/_jsx(\"button\", {\n                                  type: \"submit\",\n                                  disabled: \"\",\n                                  className: \"jsx-2354907394\" + \" \" + (cn(styles._1OyPqC, styles.fabuss) || \"\"),\n                                  children: /*#__PURE__*/_jsx(\"span\", {\n                                    className: \"jsx-2354907394\",\n                                    children: \"\\u53D1\\u5E03\"\n                                  })\n                                }), /*#__PURE__*/_jsx(\"button\", {\n                                  type: \"button\",\n                                  className: \"jsx-2354907394\" + \" \" + (styles._1OyPqC || \"\"),\n                                  children: /*#__PURE__*/_jsx(\"span\", {\n                                    className: \"jsx-2354907394\",\n                                    children: \"\\u53D6\\u6D88\"\n                                  })\n                                })]\n                              })]\n                            })\n                          })]\n                        })\n                      })\n                    })]\n                  })\n                }, child.id);\n              })]\n            })]\n          }, comment.id);\n        })]\n      }), /*#__PURE__*/_jsx(_JSXStyle, {\n        id: \"2354907394\",\n        children: [\"h1.jsx-2354907394{font-size:30px;font-weight:700;word-break:break-word;color:#404040;margin-bottom:.5em;line-height:1.42857;}\"]\n      })]\n    });\n  }\n\n}\n\nexport default Comment;","map":null,"metadata":{},"sourceType":"module"}